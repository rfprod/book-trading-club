<!DOCTYPE html>
<html>
	<head>
		<title>Book Trading Club</title>
		<script src="/public/js/jquery.min.js"></script>
	    <link href="/public/css/bootstrap.min.css" rel="stylesheet">
	    <script src="/public/js/bootstrap.min.js"></script>
		<link href="/public/css/main.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<div class="container-fluid nopadding"> 
		  <nav class="navbar navbar-inverse navbar-fixed-top topnav" role="navigation">
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#toggle-nav" aria-expanded="false">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>
		      <a class="navbar-brand" href="https://book-trading-club-rfprod.c9users.io/"><span class="glyphicon glyphicon-book"></span> Book Trading Club</a> <a class="navbar-brand hidden-xs" href="https://github.com/rfprod/book-trading-club" target="_blank">GitHub Repo</a>
		    </div>
		    <div class="collapse navbar-collapse" id="toggle-nav">
		      <div class="container-fluid"> 
		        <ul class="nav navbar-nav navbar-right">
		          	<li class="nav-pills"><a href="/"><span class="glyphicon glyphicon-search"></span> All Books</a></li>
		          	<li class="nav-pills active"><a href="#app"><span class="glyphicon glyphicon-user"></span> My Books</a></li>
		          	<li class="nav-pills"><a href="/logout"><span class="glyphicon glyphicon-remove"></span> Logout</a></li>
		        </ul>
		      </div>
		    </div>
		  </nav>
		  <a name="app"></a>
		  <div class="home sect">
		    <div class="container-fluid">
		      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		        <div class="output"> 
		          	<div class="row profile">
						<img src="/public/img/gh-mark-32px.png" alt="github logo" />
						<span class="col-xs-12 col-sm-3 col-md-3 col-lg-2">ID: <span id="profile-id" class="profile-value"></span></span>
						<span class="col-xs-12 col-sm-3 col-md-3 col-lg-2">Username: <span id="profile-username" class="profile-value"></span></span>
						<span class="col-xs-12 col-sm-3 col-md-3 col-lg-2">Display Name: <span id="display-name" class="profile-value"></span></span>
						<span class="col-xs-12 col-sm-3 col-md-3 col-lg-2">Repositories: <span id="profile-repos" class="profile-value"></span></span>
						<span class="col-xs-12 col-sm-6 col-md-6 col-lg-2">My Books: <span id="profile-books" class="profile-value"></span></span>
						<span class="col-xs-12 col-sm-6 col-md-6 col-lg-2">My Offers: <span class="glyphicon glyphicon glyphicon-arrow-down"></span><span id="profile-in-offers" class="profile-value"></span> / <span class="glyphicon glyphicon glyphicon-arrow-up"></span><span id="profile-out-offers" class="profile-value"></span></span>
					</div>
					<div class="row">
						<form role="form" action="/addbook/" id="book-adder" class="form-vertical" method="POST" enctype="application/x-www-form-urlencoded">
		                	<fieldset>
		    					<legend>Add a Book</legend>
								<div class="form-group">
			                    	<input type="text" class="form-control" placeholder="Book name" name="bookname" value="" id="add-book-name">
			                    </div>
							 	<div class="btn-group btn-group-justified" role="group">
									<div class="btn-group" role="group">
										<button id="submit-btn" type="submit" class="btn btn-default btn-success btn-add-book"><span class="glyphicon glyphicon-plus"></span> Add</button>
									</div>
								</div>
							</fieldset>
						</form>
					</div>
					<hr>
					<div class="output row books"></div>
		        </div>
		      </div>
		    </div>
		  </div>
		</div>
		<script type="text/javascript" src="common/ajax-functions.js"></script>
		<script type="text/javascript" src="controllers/clickController.client.js"></script>
		<script type="text/javascript" src="controllers/userController.client.js"></script>
		<script type="text/javascript" src="public/js/frontend-utility.js"></script>
		<script>
			function removeBook(obj){
				console.log($('.books').children().length);
				var mediaContainer = $('#'+obj.id).parent().parent().parent();
				console.log(mediaContainer.attr('id'));
				var bookISBN13 = mediaContainer.find('#book_isbn13').html();
				var bookOwnerId = $('#profile-id').html();
				console.log('data removal invoked, owner id: '+bookOwnerId+', book\'s isbn13: '+bookISBN13);
				var connRemove = new WebSocket("wss://book-trading-club-rfprod.c9users.io/removebook");
			    connRemove.onopen = function(){
				    console.log("Removing book. Connection opened");
				    connRemove.send(bookOwnerId+'|'+bookISBN13);
			    }
			    connRemove.onmessage = function(evt){
				    console.info("Received "+JSON.stringify(evt.data));
				    mediaContainer.remove();
				    console.log($('.books').children().length);
				    $('#profile-books').html($('#profile-books').html()-1);
				    if ($('.books').children().length == 0) {
				    	$('.books').html('You do not own any books yet.');
				    }
				    connRemove.close();
			    };
			    connRemove.onerror = function(error){
				    console.error("Error:"+JSON.stringify(error));
				    connRemove.close();
			    };
			    connRemove.onclose = function(){
				    console.log("Stock removed. Connection closed");
			    };
			}
		</script>
	</body>
</html>